# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание архитектуры
Для реализации проекта, был выбран паттерн проектирования MVP (Model-View-Presenter):
- Слой данных (Model) отвечает за работу с данными. Содержит значительную часть бизнес-логики.
- Слой отображения (View) отвечает за отображение данных пользователю.
- Слой представления (Presenter) отвечает за управление взаимодействием между слоем данных и отображения, а также за обработку действий пользователя.

Базовый код:

> Класс Component

Абстрактный класс. Содержит инструментарий для работы с DOM-элементами.В конструктор передаётся DOM-элемент контейнера. 

Методы:
- toggleClass - переключает класс элемента;
- setText - устанавливает текстовое значение;
- setDisabled - меняет статус блокировки элемента;
- setHidden - скрывает элемент;
- setVisible - показывает элемент;
- setImage - устанавливает изображение с альтернативным текстом;
- render - отображает элемент на странице

> Model

Определяет методы для управления данными и логикой модели. В конструктор передаётся объект для инициализации свойств модели, а также объект брокера событий.

Методы:
- emitChanges - отвечает за уведомление об изменениях в модели

> EventEmitter

Класс EventEmitter является брокером событий. Используется для управления событиями и передачей данных между компонентами.

Методы:
- on - устанавливает обработчик события;
- off - снимает обработчик события;
- emit - инициирует событие с возможностью передачи данных;
- onAll - устанавливает обработчик для всех событий;
- offAll - сбрасывает все обработчики событий;
- trigger - создаёт коллбэк-триггер, генерирующий событие при вызове

> Api

Класс Api отвечает за взаимодействие с сервером. В конструктор класса передаются:
- baseUrl: string - базовый адрес сервера
- options: RequestInit - объект в котором содержатся параметры запроса

Методы:
- handleResponse - обрабатывает ответ от сервера
- get - запрос на получение информации от сервера
- post - запрос на передачу данных на сервер

1) Классы слоя данных:

> Appstate

Наследуется от класса Model. Управляет данными, бизнес-логикой и состоянием приложения. Класс хранит информацию о каталоге товаров и о заказе пользователя.

Поля класса:
basket: Product[] = []; - массив выбранных товаров в корзине
gallery: Product[]; - каталог всех товаров
order: IOrder = { - объект для хранения данных о заказе пользователя
        items: [],
        payment: '',
        total: null,
        address: '',
        email: '',
        phone: ''
    };
preview: string | null; - id товара, выбранного для просмотра
formErrors: FormErrors = {}; - объект ошибок формы оформления заказа

Методы класса:
- setGallery - устанавливает каталог товаров
- setPreview - заполняет поле preview идентификатором выбранного товара
- addToBasket - добавляет товар в корзину
- getTotalPrice - вычисляет общую сумму товаров
- clearBasket - очищает корзину
- resetOrder - очищает поля заказа
- getProductsAmountInBasket - считает сумму товаров в корзине
- removeItemFromBasket - удаляет конкретный товар из корзины по нажатию на кнопку
- addProducts - добавляет все товары из корзины в заказ
- setOrderField - устанвливает значения в форму с заказом
- validateOrder - проверяет заполнены ли поля в форме c оплатой и адресом
- validateContacts - проверяет заполнены ли поля в форме с контактными данными
- resetSelected - обновляет поле selected у всех товаров после совершения покупки

> ProductAPI
Наследуется от базового класса Api. Позволяет получить данные о товарах с сервера, а также передать информацию о заказе на сервер.

Методы класса:
- getProductItem - получение данных об одном товаре;
- getProductList - получение данных о всех товарах;
- orderItems - отправка заказа на сервер

2) Классы слоя отображения:

> Card

Класс отвечает за отображение карточки товара. Класс задаёт внутри карточки категорию, название, изображение и цену товара. Поля - элементы разметки страницы. В конструктор передаётся темплейт карточки, а также экземпляр объекта EventEmitter, отвечающий за работу событий.

Поля класса:
- _category: HTMLElement - категория товара
- _title: HTMLElement - заголовок товара
- _image: HTMLImageElement - картинка товара
- _price: HTMLElement - цена товара
- _button: HTMLButtonElement; - элемент разметки кнопки товара

Методы:
- set id(value: string) - устанавливает идентификатор карточки
- get id() - возвращает идентификатор
- set title(value: string) - устанавливает название товара
- get title() - возвращает название
- set image(value:string) - устанавливает изображение
- set category(value: string) - устанавливает категорию товара
- get category() - возвращает категорию
- set button(value: string) - устанавливает текст кнопки
- set price(value:number | null) - устанавливает цену товара

> CatalogueItemPreview 

Наследуется от класса Card. Класс описывает карточку товара при открытии модального окна. 

Поле класса:
- _description - описание товара

Методы:
- set description - устанавливает описание товара

> Form

Отвечает за отображение формы на сайте. 
В конструктор первым аргументом передается контейнер, а вторым - объект events, отвечающий за вызов событий при заполнении полей формы.

Поля класса:
- _submit: HTMLButtonElement - кнопка отправки формы
- _errors: HTMLElement - элемент для отображения ошибок валидации формы

Методы:
- onInputChange - отслеживает изменения в полях формы
- valid - устанавливает состояние кнопки в зависимости от того, заполнено ли поле/поля
- errors - устанавливает текст ошибки
- render - определяет вид формы

> Modal

Наследуется от базового класса Component. Отвечает за работу модальных окон в приложении. 

Поля класса:
- closeButton: HTMLButtonElement - кнопка закрытия модального окна;
- content: HTMLElement - содержимое модального окна

Методы:
- set content - устанавливает содержимое внутри модального окна
- open - открыть модальное окно
- close - закрыть модальное окное
- render - отобразить модальное окно

> Basket

Отвечает за отображение данных в корзине покупок. В конструктор передаётся имя блока, используемое для поиска элементов внутри контейнера, контейнер, в котором будет отображаться вся информация о выбранных товарах, а также экземпляр брокера событий.

Поля класса:
- _list: HTMLElement - список товаров в корзине
- _total: HTMLElement - общая сумма товаров
- _button: HTMLButtonElement - кнопка, отвечающая за переход к оформлению заказа

Методы:
- set items: HTMLElement[] - устанавливает список товаров в корзине;
- set total: number - отображает общую цену товаров
- disableButton - отключает кнопку 'оформить'
- updateIndices - обновляет индексы при удалении товара из корзины

> ProductInBasket

Наследуется от базового класса Component. Реализует отображение товара в корзине.

Поля класса:
- _index: HTMLElement - индекс товара в корзине
- _title: HTMLElement - название товара в корзине
- _price: HTMLElement - цена товара
- _button: HTMLButtonElement - кнопка удаления товара из корзины

Методы:
- set title(value: string) - устанавливает название товара в корзине
- set price(value: number) - устанавливает цену товара 
- set index(value: number) - устаналивает индекс товара в корзине

> Page

Наследуется от базового класса Component. Реализует отображение главной страницы приложения. В конструктор передаётся контейнер и экзмепляр брокера событий.

Поля класса:
- _counter: HTMLElement - счётчик выбранных товаров
- _gallery: HTMLElement - каталог всех товаров
- _wrapper: HTMLElement - элемент-обертка основного контента страницы
- _basket: HTMLElement - элемент корзины

Методы класса:
- set counter(value:number) - сеттер, устанавливает количество выбранных товаров в счётчик корзины
- set gallery(items: HTMLElement[]) - сеттер, отображает каталог товаров на странице
- set locked(value: boolean) - сеттер, отвечает за блокировку прокрутки страницы при открытии модального окна. При открытии модального окна прокрутка блокируется, при закрытии - разблокируется

> Order

Наследуется от класса Form. Класс Order определяет форму с выбором способа оплаты и вводом адреса доставки. В конструктор передаётся название блока, используемое для поиска элементов в контейнере, контейнер, и экзмепляр брокера событий.

Поля класса:
- _card: HTMLButtonElement - DOM элемент кнопки способа оплаты. Способ оплаты - онлайн
- _cash: HTMLButtonElement - DOM элемент кнопки способа оплаты. Способ оплаты - при получении
- _address: HTMLInputElement - DOM элемент поля с вводом адреса доставки

Методы класса:
- clearOrderFields() - очищает поля заказа: сбрасывает состояния кнопок и очищает поле с адресом

> Contacts
Наследуется от класса Form. Класс Contacts определяет форму с вводом телефона и почты.В конструктор передаётся контейнер и экземпляр брокера событий.

Поля класса:
- _phone: HTMLInputElement - поле ввода телефона
- _email: HTMLInputElement - поле ввода почты

Методы класса:
- clearContactsFields() - очищает поля с контактными данными

> Success
Класс Success наследуется от базового класса Component. Выводит в модальном окне информацию об успешном заказе. В конструктор передаётся название блока, используемое для поиска элементов в контейнере, контейнер, и экзмепляр брокера событий.

Поля класса:
- _button: HTMLButtonElement - кнопка, выполняющая переход на главную страницу к каталогу товаров
- _description: HTMLElement - описание итоговой стоимости товара

Методы класса:
- set description(value:number) - сеттер, устанавливает отображение общей стоимости товаров


Код, отвечающий за слой представления находится в корневом файле index.ts, где взаимодействие слоя данных и отображения будет осуществляться с помощью событий генерируемых EventEmitter.